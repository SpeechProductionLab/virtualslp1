<html>
<head>

        <meta charset="utf-8">

        <title>PD Assessment APP</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
		<link href="https://vjs.zencdn.net/7.10.2/video-js.css" rel="stylesheet" />
		<link rel="stylesheet" href="plyr.css" />
		<script src="RecordRTC.js"></script>
		<script src="adapter-latest.js"></script>
		<script src="jquery.min.js"></script>
		<script src="stopwatch.js"></script>
		<script src="plyr.js"></script>
		<script src="video.min.js"></script>
		<script src="wzrecorder.js"></script>
		<script src="DetectRTC.js"></script>

<style type="text/css">

/* change player background color */



.column {
  float: left;
  width: 100%;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

.video-js, #intro-video1, #intro-video2, #intro-video3, #intro-video4, #intro-video5, #intro-video6, #intro-video7, #intro-video8, #intro-video9, #intro-video10, #intro-video11, #intro-video12, #intro-video13, #intro-video14, #intro-video15, #intro-video16, #intro-video17, #intro-video18, #intro-video19, #intro-video20 { 
	width: 100%; 
	height: 100%;
}
.chatBox { margin: 0 auto;height: 450px; border: 2px solid black;padding: 10px;}
.dude { float: top; margin: 0 auto;height: 450px;width: 50%; border: 2px solid black;padding: 10px;}
.boob { padding: 50px 20px; margin: 0 auto;}

.button {
  cursor: pointer;
  display: block;
  width: 160px;
  border: 1px solid black;
  font-size: 16px;
  text-align: center;
  padding-top: 2px;
  padding-bottom: 4px;
  color: white;
  background-color: darkgreen;
  text-decoration: none;
}
		
		
		
		
* {
  box-sizing: border-box;
}

body {
  background-color: #f1f1f1;
}

#regForm {
  background-color: #ffffff;
  margin: 0px auto;
  font-family: Raleway;
  padding: 40px;
  min-width: 300px;
}

h1 {
  text-align: center;  
}

input {
  padding: 10px;
  font-size: 17px;
  font-family: Raleway;
  border: 1px solid #aaaaaa;
}

select {
  padding: 10px;
  width: 50%;
  font-size: 17px;
  font-family: Raleway;
  border: 1px solid #aaaaaa;
}

/* Mark input boxes that gets an error on validation: */
input.invalid {
  background-color: #ffdddd;
}

/* Hide all steps by default: */
.tab {
  display: none;
  overflow: hidden;
}

button {
  background-color: #4CAF50;
  color: #ffffff;
  border: none;
  padding: 10px 20px;
  font-size: 17px;
  font-family: Raleway;
  cursor: pointer;
}

#submitbutton {
  background-color: #4CAF50;
  color: #ffffff;
  border: none;
  padding: 10px 20px;
  font-size: 17px;
  font-family: Raleway;
  cursor: pointer;
}

button:hover {
  opacity: 0.8;
}

#submitbutton:hover {
  opacity: 0.8;
}

#prevBtn {
  background-color: #bbbbbb;
}

/* Make circles that indicate the steps of the form: */
.step {
  height: 15px;
  width: 15px;
  margin: 0 2px;
  background-color: #bbbbbb;
  border: none;  
  border-radius: 50%;
  display: inline-block;
  opacity: 0.5;
}

.step.active {
  opacity: 1;
}

/* Mark the steps that are finished and valid: */
.step.finish {
  background-color: #4CAF50;
}

#work-in-progress {
  position: fixed;
  width: 100%;
  height: 100%;
  font-size: 30px;
  text-align: center;
  vertical-align: middle;
  color: #000000;
  z-index: 200000;
  background-color: #FFFFFF;
}

.work-spinner {
  background-color: rgba(0,0,0,0);
  border: 9px solid rgba(27,61,226,0.9);
  opacity: .9;
  border-left: 5px solid rgba(0,0,0,0);
  border-radius: 120px;
  -webkit-box-shadow: 0 0 35px #1B3DE2;
  box-shadow: 0 0 35px #1B3DE2;
  width: 100px;
  height: 100px;
  margin: 0 auto;
  -moz-animation: spin .5s infinite linear;
  -webkit-animation: spin .5s infinite linear;
  -o-animation: spin .5s infinite linear;
  animation: spin .5s infinite linear;
}

@-moz-keyframes spin {
 from {
     -moz-transform: rotate(0deg);
 }
 to {
     -moz-transform: rotate(360deg);
 }
}

@-webkit-keyframes spin {
 from {
     -webkit-transform: rotate(0deg);
 }
 to {
     -webkit-transform: rotate(360deg);
 }
}

@keyframes spin {
 from {
     transform: rotate(0deg);
 }
 to {
     transform: rotate(360deg);
 }
}
@-o-keyframes spin {
 from {
     transform: rotate(0deg);
 }
 to {
     transform: rotate(360deg);
 }
}


video {
    -moz-transform: scale(-1, 1);
	-webkit-transform: scale(-1, 1); -o-transform: scale(-1, 1);
	transform: scale(-1, 1); filter: FlipH;
}

#your-video {
	width: 100%;
	height: 350px;
}

#disappear-video {
	width: 50%;
	margin: auto;
}

.meter {
    background: grey;
    height: 40px;
    width: 0;
}

.meter1 {
    background: grey;
    height: 40px;
    width: 0;
}

.meter.done {
    background-color: green;
}

.meter1.done {
    background-color: green;
}

#disappear-video, #disappear-audio {
	display: none;
}

#meter-container {
	width: 50%;
	margin: auto;
}





</style>

</head>
	
<body>


<center>
<h1>Video Recording for PD Assessment</h1>
</center>

<form id="regForm" autocomplete="off">
  <!-- One "tab" for each step in the form: -->
<div class="tab"><h2><center>Task 1 Instructions</center></h2>
  	<div class="row"><div class="dude">
	<video id="pause1"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task1.mp4" type="video/mp4">
	Your browser does not support the video tag.</div></div>
</div>
<div class="tab"><h2><center>Task 1</center></h2>
</div>
<div class="tab"><h2><center>Task 2 Instructions</center></h2>
	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause2"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task2.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 2</center></h2>
</div>
<div class="tab"><h2><center>Task 3 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause3"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 3</center></h2>
</div>
<div class="tab"><h2><center>Task 4 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause4"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 4</center></h2>
</div>
<div class="tab"><h2><center>Task 5 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause5"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 5</center></h2>
</div>
<div class="tab"><h2><center>Task 6 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause6"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 6</center></h2>
</div>
<div class="tab"><h2><center>Task 7 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause7"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 7</center></h2>
</div>
<div class="tab"><h2><center>Task 8 Instructions</center></h2>
  	<div class="row"><div class="dude">
	<video id="pause8"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 8</center></h2>
</div>
<div class="tab"><h2><center>Task 9 Instructions</center></h2>
  	<div class="row"><div class="dude">
	<video id="pause9"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 9</center></h2>
</div>
<div class="tab"><h2><center>Task 10 Instructions</center></h2>
  	<div class="row"><div class="dude">
	<video id="pause10"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 10</center></h2>
</div>
<div class="tab"><h2><center>Task 11 Instructions</center></h2>
  	<div class="row"><div class="dude">
	<video id="pause11"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 11</center></h2>
</div>
<div class="tab"><h2><center>Task 12 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause12"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 12 Audio</center></h2>
</div>
<div class="tab"><h2><center>Task 12 Video</center></h2>
</div>
<div class="tab"><h2><center>Task 13 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause13"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 13</center></h2>
</div>
<div class="tab"><h2><center>Task 14 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause14"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 14</center></h2>
</div>
<div class="tab"><h2><center>Task 15 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause15"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 15</center></h2>
</div>
<div class="tab"><h2><center>Task 16 Instructions</center></h2>
  	<div class="row"><div class="dude">
	<video id="pause16"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 16 Audio</center></h2>
</div>
<div class="tab"><h2><center>Task 16 Video</center></h2>
</div>
<div class="tab"><h2><center>Task 17 Instructions</center></h2>
  	<div class="row"><div class="dude">
	<video id="pause17"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 17 Audio</center></h2>
</div>
<div class="tab"><h2><center>Task 17 Video</center></h2>
</div>
<div class="tab"><h2><center>Task 18 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause18"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 18 Audio</center></h2>
</div>
<div class="tab"><h2><center>Task 18 Video</center></h2>
</div>
<div class="tab"><h2><center>Task 19 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause19"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 19 Audio</center></h2>
</div>
<div class="tab"><h2><center>Task 19 Video</center></h2>
</div>
<div class="tab"><h2><center>Task 20 Instructions</center></h2>
  	<div class="row"><div class="dude"><span id = "intro">
	<video id="pause20"
	class="video-js vjs-default-skin vjs-big-play-centered" 
	controls 
	data-setup="{}">
	<source src="task3.mp4" type="video/mp4">
	Your browser does not support the video tag.</div>
</div>
</div>
<div class="tab"><h2><center>Task 20</center></h2>
</div>
<div class="tab">
  	<div class="row">
	<div class="column"><div class="dude"><span id = "intro"><center>
	</br></br>
	<h3><b>Thank You for Your Responses!<b>
	</br></br>
	<b>You Can Now Close This Tab.<b></h3>
	</center></span>
</div>
</div>
</div>
</div>
<div id="disappear-video">
	<center>
	<button type='button' id="btn-record">Record</button>
	<button type='button' id="btn-record1">Stop</button>
	<hr>
	<video id="your-video" autoplay playsinline controls></video>
	<h2 id="time" unselectable="on">00:00:000</h2>
	</br>
	<div>
	<button type='button' id="videosubmit">UPLOAD</button>
	</div>
	<!--
	<div id="resultResponse"></div>
	-->
	</center>
	<div class="meter"></div>
</div>
<div id="disappear-audio">
			<center>
				<div class="container" style="margin:3rem">
					<p>
						<button type='button' id="record1">RECORD</button>
					</p>
					<p>
						Duration: <span id="duration1">0 s</span>
					</p>
					
					<p>
						<audio id="player1" controls></audio>
					</p>
					<div>
						<button type='button' id="audiosubmit">UPLOAD</button>
					</div>
					<div id="result1"></div>
				</div>
			</center>
			<div id='meter-container'>
			<div class="meter1"></div>
			</div>
</div>
<div style="overflow:auto;">
    <div style="float:right;">
      
      <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
    </div>
  </div>
  <!-- Circles which indicates the steps of the form: -->
  <div style="text-align:center;margin-top:40px;">
    <span class="step"></span>
    <span class="step"></span>
    <span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
    <span class="step"></span>
    <span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	<span class="step"></span>
	
 </div>
</form>






<script>
// it seems that we did not make getUserMedia request yet
navigator.mediaDevices.getUserMedia({
	audio: true,
	video: true
});
// list of all video tabs
var lst_video = [3,5,7,9,11,13,15,17,24,33,36,39,42];
var lst_task = ['0','SIT', '2', 'RST_REST1', '4', 'NSM_TNG_PROTRUSION', '6', 'NSM_TNG_LATNORMAL', '8', 'NSM_TNG_NOSE', '10', 'NSM_TNG_LATFAST', '12', 'NSM_BIGSMILE', '14', 'NSM_PUCKER', '16', 'NSM_SMILEFAST', '18', 'NSM_COUGH', '20', 'NSM_SWALLOW', '22', 'CHEW_CRACKER', 'CHEW_CRACKER', '25', 'VWL_SUSTAIN', '27', 'SENT_CAPEV', '29', 'PSG_BAMBOO', '31', 'DDK_PA', 'DDK_PA', '34', 'DDK_TA', 'DDK_TA', '37', 'DDK_KA', 'DDK_KA', '40','DDK_PATAKA', 'DDK_PATAKA', '43','BBP_NORMAL']

// list of all audio tabs
var lst_audio = [1,19,21,23,26,28,30,32,35,38,41,44];

var tempBlob;
var submitButtonAudio = document.getElementById('audiosubmit');
var vid_pause1 = document.getElementById('pause1');
var vid_pause2 = document.getElementById('pause2');
var vid_pause3 = document.getElementById('pause3');
var vid_pause4 = document.getElementById('pause4');
var vid_pause5 = document.getElementById('pause5');
var vid_pause6 = document.getElementById('pause6');
var vid_pause7 = document.getElementById('pause7');
var vid_pause8 = document.getElementById('pause8');
var vid_pause9 = document.getElementById('pause9');
var vid_pause10 = document.getElementById('pause10');
var vid_pause11 = document.getElementById('pause11');
var vid_pause12 = document.getElementById('pause12');
var vid_pause13 = document.getElementById('pause13');
var vid_pause14 = document.getElementById('pause14');
var vid_pause15 = document.getElementById('pause15');
var vid_pause16 = document.getElementById('pause16');
var vid_pause17 = document.getElementById('pause17');
var vid_pause18 = document.getElementById('pause18');
var vid_pause19 = document.getElementById('pause19');
var vid_pause20 = document.getElementById('pause20');
// For today's date
Date.prototype.today = function () { 
    return this.getFullYear() +(((this.getMonth()+1) < 10)?"0":"") + (this.getMonth()+1) + ((this.getDate() < 10)?"0":"") + this.getDate();
}

// For the time now
Date.prototype.timeNow = function () {
     return ((this.getHours() < 10)?"0":"") + this.getHours() + ((this.getMinutes() < 10)?"0":"") + this.getMinutes() + ((this.getSeconds() < 10)?"0":"") + this.getSeconds();
}
// subject ID Generator
var subjectID = Math.floor((Math.random() * 100000) + 1).toString();

/* Disables the enter key to prevent accidental submission */
$(document).keypress(
  function(event){
    if (event.which == '13') {
      event.preventDefault();
    }
});

/*
get isMobile(){
	if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
		return true;
    } else{
		return false;
    }
}
*/

// count down code begins


// detect if device is mobile
const obj = {
  get isMobile() {
    if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
		return true;
    } else{
		return false;
    }
  }
};
// change this to "https://memoirstudy.csd.uwo.ca/pd-webapp2/index_mobile.html" when you want to upload to server
if (obj.isMobile) {
	//window.location.href = "http://localhost:81/pd-webapp2/index_mobile.html";
	window.location.href = "https://memoirstudy.csd.uwo.ca/pd-webapp4/index_mobile.html";
}
// starting the code related to audio recorder
var recorder1 = new WzRecorder({
		visualizer: {
		element: document.getElementById('canvas1')
		},
		onRecordingStop: function(blob) {
			document.getElementById('player1').src = URL.createObjectURL(blob);
			tempBlob = blob;
			document.getElementById("audiosubmit").disabled = false; 
			document.getElementById("audiosubmit").style.opacity = 1;
			document.getElementById('result1').innerHTML = "";
			document.getElementById('record1').innerHTML = "RECORD";
		},
		onRecording: function(milliseconds) {
			document.getElementById('duration1').innerHTML = Math.floor(milliseconds/1000) + " " + 's';
			document.getElementById('result1').innerHTML = "";
			document.getElementById('record1').innerHTML = "STOP";
		}
});
// wire up the microphone button to toggle recording
document.getElementById('record1').onclick = recorder1.toggleRecording;
	
	

// starting the code related to video recorder

const players = new Plyr('#your-video', {
	
});

var recorder;
var yourVideo = document.getElementById('your-video');
var recordButton = document.getElementById('btn-record');
var submitButton = document.getElementById('videosubmit');
var stopButton = document.getElementById('btn-record1');
submitButtonAudio.disabled = true; 
submitButtonAudio.style.opacity = 0.3;
var bloby;
stopButton.disabled = true;
stopButton.style.opacity = 0.3;
recordButton.onclick = function() {
    recordButton.disabled = true;
    recordButton.style.opacity = 0.3;
	show();
	reset();

    var cameraProperties = {
        video: {
            width: 1920,
            height: 1080
        },
        audio: true
    };
	//players.toggleControls(false);
	yourVideo.src = 'timer.mp4';
	setTimeout(function(){ navigator.mediaDevices.getUserMedia(cameraProperties).then(function(cameraStream) {
			stopButton.disabled = false;
			stopButton.style.opacity = 1;
            yourVideo.volume = 0;
            yourVideo.srcObject = cameraStream;
			//players.toggleControls(true);

            recorder = RecordRTC(cameraStream, {
                videoBitsPerSecond: 51200000,
				audioBitsPerSecond: 320000,
                mimeType: 'video/mp4'
            });
            recorder.startRecording();
			// timer start function
			start();
			stp = cameraStream;
			setTimeout(function() {
                recorder.stopRecording(function() {
					stopButton.disabled = true;
					stopButton.style.opacity = 0.3;
					recordButton.disabled = false;
					recordButton.style.opacity = 1;
                    var blob = recorder.getBlob();
					cameraStream.stop();
					// timer stop and update functions
					stop();
					update();
                    //alert('Recording size: ' + bytesToSize(blob.size));

                    var videoURL = URL.createObjectURL(blob);
					
					//console.log(bloby);
					//source = videoURL;
                    yourVideo.srcObject = null;
                    yourVideo.volume = 1;
                    yourVideo.src = videoURL;
					bloby = blob;
					submitButton.disabled = false;
					submitButton.style.opacity = 1;
                });
            }, 20000);
	}); }, 3500);
}
stopButton.onclick = function() {
		stopButton.disabled = true;
		stopButton.style.opacity = 0.3;
		recordButton.disabled = false;
		recordButton.style.opacity = 1;
		recorder.stopRecording(function() {
			var blob = recorder.getBlob();
			stp.stop();
			stop();
			update();
			//alert('Recording size: ' + bytesToSize(blob.size));

			var videoURL = URL.createObjectURL(blob);
			//console.log(bloby);
			yourVideo.srcObject = null;
			yourVideo.volume = 1;
			yourVideo.src = videoURL;
			bloby = blob;
			submitButton.disabled = false;
			submitButton.style.opacity = 1;
		});
}


submitButton.addEventListener("click", function () {
	var filename = subjectID + "_" + lst_task[currentTab] + "_" + new Date().today().toString() + "_" + new Date().timeNow().toString() + "_r.mp4";
	//var dir = "/pd_assessment/";
    //var formData = new FormData();
	var accessToken = "DO2X9e2lvggAAAAAAAAAAVPz8Pd2c_K2cUrx7qXLi8CsaqNLuApk49AsfKuSn9n5";
	var uploadUrl = "https://content.dropboxapi.com/2/files/upload";
    var xhr = new XMLHttpRequest();
    //formData.append('name', filename);
    //formData.append('video', bloby);
    
    xhr.open('POST', uploadUrl, true);
	xhr.setRequestHeader("Authorization", "Bearer " + accessToken);
    //xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
	xhr.setRequestHeader("Content-Type", "application/octet-stream");
	xhr.setRequestHeader('Dropbox-API-Arg', JSON.stringify({
		//path: dir + filename
		path: "/" + filename
	}));
    xhr.upload.addEventListener("load", function () {
        $(".meter").addClass("done");
    });
    xhr.upload.addEventListener("progress", function (event) {
        if (event.lengthComputable) {
            var complete = (event.loaded / event.total * 100 | 0);
            $('.meter').css('width', complete + '%');
			$('.meter').html(complete.toString() + '%');
			if (complete == 100) {
				$('.meter').css("background-color", 'green');
				document.getElementById("nextBtn").disabled = false;
				document.getElementById("nextBtn").style.opacity = 1;
			}
        }
    });
	//xhr.onload = function(){ document.getElementById("resultResponse").innerHTML = this.response; };
    
    xhr.send(bloby);
	submitButton.disabled = true;
	submitButton.style.opacity = 0.3;
	recordButton.disabled = true;
    recordButton.style.opacity = 0.3;
    return false;
});

submitButtonAudio.addEventListener("click", function () {
	var filename = subjectID + "_" + lst_task[currentTab] + "_" + new Date().today().toString() + "_" + new Date().timeNow().toString() + "_r.wav";
	//var dir = "/pd_assessment/";
    //var formData = new FormData();
	var accessToken = "DO2X9e2lvggAAAAAAAAAAVPz8Pd2c_K2cUrx7qXLi8CsaqNLuApk49AsfKuSn9n5";
	var uploadUrl = "https://content.dropboxapi.com/2/files/upload";
    var xhr = new XMLHttpRequest();
    
    xhr.open('POST', uploadUrl, true);
	xhr.setRequestHeader("Authorization", "Bearer " + accessToken);
    //xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
	xhr.setRequestHeader("Content-Type", "application/octet-stream");
	xhr.setRequestHeader('Dropbox-API-Arg', JSON.stringify({
		//path: dir + filename
		path: "/" + filename
	}));
    xhr.upload.addEventListener("load", function () {
        $(".meter1").addClass("done");
    });
    xhr.upload.addEventListener("progress", function (event) {
        if (event.lengthComputable) {
            var complete = (event.loaded / event.total * 100 | 0);
            $('.meter1').css('width', complete + '%');
			$('.meter1').html(complete.toString() + '%');
			if (complete == 100) {
				$('.meter1').css("background-color", 'green');
				document.getElementById("nextBtn").disabled = false;
				document.getElementById("nextBtn").style.opacity = 1;
			}
        }
    });
	//xhr.onload = function(){ document.getElementById("resultResponse").innerHTML = this.response; };
    
    xhr.send(tempBlob);
	  document.getElementById('audiosubmit').disabled = true;
	  document.getElementById('audiosubmit').style.opacity = 0.3;
    return false;
});


// starting the code related to form
function isOdd(num) { return num % 2;}
function isVideo(num) { return lst_video.includes(num);}
function isAudio(num) { return lst_audio.includes(num);}

var currentTab = 0; // Current tab is set to be the first tab (0)
showTab(currentTab); // Display the current tab

function showTab(n) {
  // This function will display the specified tab of the form...
  var x = document.getElementsByClassName("tab");
  x[n].style.display = "block";
  //... and fix the Previous/Next buttons:
//  if (n == 0) {
//    document.getElementById("prevBtn").style.display = "none";
//  } else {
//    document.getElementById("prevBtn").style.display = "inline";
//  }
  if (isVideo(currentTab)) {
  
   document.getElementById("disappear-video").style.display = "block";
   document.getElementById("nextBtn").disabled = true;
   document.getElementById("nextBtn").style.opacity = 0.3;
   recordButton.disabled = false;
   recordButton.style.opacity = 1;
  }else{
   document.getElementById("disappear-video").style.display = "none";
  }
  if (isAudio(currentTab)) {
  
   document.getElementById("disappear-audio").style.display = "block";
   document.getElementById("nextBtn").disabled = true;
   document.getElementById("nextBtn").style.opacity = 0.3;
  }else{
   document.getElementById("disappear-audio").style.display = "none";
  }
  if (n == (x.length - 1)) {
   
    document.getElementById("nextBtn").innerHTML = "Submit";
    document.getElementById("nextBtn").style.display = "none";
    //document.getElementById("prevBtn").style.display = "none";
  } else {
    document.getElementById("nextBtn").innerHTML = "Next";
  }
  //... and run a function that will display the correct step indicator:
  fixStepIndicator(n)
}

function nextPrev(n) {
  // This function will figure out which tab to display
  var x = document.getElementsByClassName("tab");
  // Exit the function if any field in the current tab is invalid:
  if (n == 1 && !validateForm()) return false;
  // Hide the current tab:
  x[currentTab].style.display = "none";
  // Increase or decrease the current tab by 1:
  currentTab = currentTab + n;
  // add reset codes
  vid_pause1.pause();
  vid_pause2.pause();
  vid_pause3.pause();
  vid_pause4.pause();
  vid_pause5.pause();
  vid_pause6.pause();
  vid_pause7.pause();
  vid_pause8.pause();
  vid_pause9.pause();
  vid_pause10.pause();
  vid_pause11.pause();
  vid_pause12.pause();
  vid_pause13.pause();
  vid_pause14.pause();
  vid_pause15.pause();
  vid_pause16.pause();
  vid_pause17.pause();
  vid_pause18.pause();
  vid_pause19.pause();
  vid_pause20.pause();
  $('.meter').css('width', 0 + '%');
  $('.meter').html('');
  $('.meter').css("background-color", 'grey');
  //$('.meter > .done').css("background-color", 'green');
  $('.meter1').css('width', 0 + '%');
  $('.meter1').html('');
  $('.meter1').css("background-color", 'grey');
  //$('.meter1 > .done').css("background-color", 'green');
  document.getElementById("your-video").src = '';
  document.getElementById("player1").src = '';
  document.getElementById("time").innerHTML = '00:00:000';
  
  // scroll up at start of new tab
  window.scrollTo(0,0);
  // if you have reached the end of the form...
  if (currentTab >= x.length) {
    // ... the form gets submitted:
    document.getElementById("regForm").submit();
    return false;
  }
  // Otherwise, display the correct tab:
  showTab(currentTab);
}

function validateForm() {
  // This function deals with validation of the form fields
  var x, y, i, valid = true;
  x = document.getElementsByClassName("tab");
  y = x[currentTab].getElementsByTagName("input");
  // A loop that checks every input field in the current tab:
  for (i = 0; i < y.length; i++) {
    // If a field is empty...
    if (y[i].value == "") {
      // add an "invalid" class to the field:
      y[i].className += " invalid";
      // and set the current valid status to false
      valid = false;
    }
	
	if(/[^A-Za-z]/.test(y[i].value)) {
	  y[i].className += " invalid";
	  valid = false;
	}

  }
  // If the valid status is true, mark the step as finished and valid:
  if (valid) {
    document.getElementsByClassName("step")[currentTab].className += " finish";
  }
  return valid; // return the valid status
}

function fixStepIndicator(n) {
  // This function removes the "active" class of all steps...
  var i, x = document.getElementsByClassName("step");
  for (i = 0; i < x.length; i++) {
    x[i].className = x[i].className.replace(" active", "");
  }
  //... and adds the "active" class on the current step:
  x[n].className += " active";
}

</script>
</body>
</html>
